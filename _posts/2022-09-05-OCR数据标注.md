---
layout:     post
title:      OCR数据标注
subtitle:   2022年8月
date:       2022-8-31
author:     franztao
header-img: post-bg-re-vs-ng2.jpg
catalog: true
tags:
    - Blog

---

一、整体要求

对医药期刊和专利文本，标注的latex字符表示

典型样例

二、数据统计：

| 分类     | 比例  |
| ------ | --- |
| 纯字母    | x   |
| 纯数字    | x   |
| 字母数字混合 | x   |
| +-     | x   |
| 上标     | x   |
| 下标     | x   |
| >或<    | x   |

三、标注原则(按照阅读顺序横向文本-从左至右、竖向文本-从上至下)  

1. 需分清楚大小写情况，比如Equal 不能标注成equal,除特殊难分辨大小写字母如C,O,W,U,S,Z,X,V  
   转写时，数字0、1、2需要和字母O、I(大写i)、Z、l(小写L)进行严格区分，不能相互替换  

2. 正负号标注为+-  

3. 上标标注例如 $$a^{123} $$,上标范围内的需要括号括住  

4. 下标标注例如 $$a_{123}$$,下标范围内的需要括号括住  

5. 有换行，标注为 \n  

6. 竖向文本，备注中加入 "竖向"  

7. 空格文字转写规则  
   空格：只在**分隔拼音/英文单词和表示替代时使用**（中文、英文、数字、符号这四种类别相互之间即使图片上有空格，转写也均不能有空格）。  
   （1）中文与中文、英文、数字、符号之间均无空格(转写时需将图片中的空格忽略掉)  
   （2）数字与数字、符号之间均无空格  
   （3）英文与英文之间，图片上有空格，则转写需空格，图片上无空格，则转写无需空格  
   （4）**同一英文单词内部字母间由字间距造成的空格**，转写时无需空格  

8. 标点符号  
      1). 标点符号分为通用标点符号和特殊标点符号  
      （1）①通用标点符号：键盘上能看到的所有标点符号(同时包含中/英状态下的标点符号)  
      （2）②特殊标点符号：键盘上能看到的以外的所有符号，例如✔↖↑↗←→↙↓↘▽◇☆等  
   
     2).  如何标注
      （1）**中英文状态下形态一样符号，不必区分中英文符号**：如：！？：，；-（）" ' 等  
      （2） **中英文状态下形态不同的符号**，中文符号：如【】[]「」 。. 《》<>等，找到对应英文符号标注  

9. 舍弃情况  
      1)1、小语种：非中、英文字母、非数字的其他语言(如：日、韩、阿拉伯语等其他语言)，标注为？  

10. 注：特殊无法标注的，在备注栏标上，如内容不规则、图片清晰度等、背景干扰等 。只单独一个字符无法标注的用@字符标注，以做区分

典型样例

| 类别  | 出错原因                  | 样例                                                                                                       | 标注规则                |
| --- | --------------------- | -------------------------------------------------------------------------------------------------------- | ------------------- |
|     | 边界被截断的字符              | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-09-30-11-33-19-image.png) | 抛弃冗余的边界被截断字符，标注为”7” |
|     | (±)-Me                | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-09-30-11-42-03-image.png) | +--Me               |
|     | hha_{V}1.1^{b}        | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-09-30-11-45-37-image.png) | hNa_{v}1.1^{b}      |
|     | AUC_{(0-∞)}((µg/L)·h) | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-09-30-12-03-04-image.png) |                     |
|     | GSK-3βIC_{50}(µM)     | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-09-30-12-05-38-image.png) |                     |
|     |                       | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-09-30-12-10-33-image.png) |                     |

四、标注数据前统计（元数据信息字段（参考下图数据视角和数据采集采样构造））

| OCR | 格子平均宽boxes_width     |                |                                                                                                                                                                                                                       |     |
| --- | -------------------- | -------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --- |
|     | 格子平均高boxes_height    |                |                                                                                                                                                                                                                       |     |
|     | 模糊度0-3 0最好           |                |                                                                                                                                                                                                                       |     |
|     | 上下标                  | 上标superscripts |                                                                                                                                                                                                                       |     |
|     |                      | 下标subscripts   |                                                                                                                                                                                                                       |     |
|     | 中文is_chinese_text    |                |                                                                                                                                                                                                                       |     |
|     | 数字isnumerics         | 整数isdigits     |                                                                                                                                                                                                                       |     |
|     |                      | 浮点数isdecimals  |                                                                                                                                                                                                                       |     |
|     | 文本isasciis           | 小写islowers     |                                                                                                                                                                                                                       |     |
|     |                      | 字母isalpha      |                                                                                                                                                                                                                       |     |
|     | 换行                   |                |                                                                                                                                                                                                                       |     |
|     | 运算符号operaters        | 正负号pms         | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-11-10-17-14-45-image.png)<br/>![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-11-10-17-19-55-image.png) |     |
|     | 是否存在下划线              |                | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-11-10-17-15-58-image.png)                                                                                                              |     |
|     | is_special_alpha特殊符号 |                | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-11-10-17-25-03-image.png)                                                                                                              |     |

五、算法评价指标  
1）对每个样例预测出识别的字符串，去除冗余两个以上的空格，跟标注字符串全文完全匹配，计算准确率  
2）据检率，样本中不能用来ocr预测的样本比

统计时，会去除冗余空额，换行、替换易混淆字符三个角度的metric

六、输出json格式

而 JSON Line 格式则使用 `json.dumps` 将 JSON 格式的标注转换为文本内容后存放在 .jsonl 文件中，其内容形似一个字典，将文件名和文本标注信息分别存放在 `filename` 和 `text` 字段中。

```
{"filename": "img1.jpg", "text": "OpenMMLab"}
{"filename": "img2.jpg", "text": "MMOCR"}
```
