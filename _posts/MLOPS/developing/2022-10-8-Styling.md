---
layout:     post
title:      æ ·å¼å’Œæ ¼å¼ä»£ç 
subtitle:   2022å¹´10æœˆ
date:       2022-10-10
author:     franztao
header-img: post-bg-re-vs-ng2.jpg
catalog: true
tags:
    -Styling and Formatting Code

---


## ç›´è§‰

> é˜…è¯»ä»£ç çš„é¢‘ç‡é«˜äºç¼–å†™ä»£ç çš„é¢‘ç‡ã€‚â€”â€”Guido [Van Rossum](https://en.wikipedia.org/wiki/Guido_van_Rossum)ï¼ˆPython çš„ä½œè€…ï¼‰

å½“æˆ‘ä»¬ç¼–å†™ä¸€æ®µä»£ç æ—¶ï¼Œå‡ ä¹ä»æ¥éƒ½ä¸æ˜¯æˆ‘ä»¬æœ€åä¸€æ¬¡çœ‹åˆ°å®ƒæˆ–æœ€åä¸€æ¬¡ç¼–è¾‘å®ƒã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è§£é‡Šå‘ç”Ÿäº†ä»€ä¹ˆï¼ˆé€šè¿‡[æ–‡æ¡£](https://madewithml.com/courses/mlops/documentation/)ï¼‰å¹¶ä½¿å…¶æ˜“äºé˜…è¯»ã€‚ä½¿ä»£ç æ›´å…·å¯è¯»æ€§çš„æœ€ç®€å•æ–¹æ³•ä¹‹ä¸€æ˜¯éµå¾ªä¸€è‡´çš„æ ·å¼å’Œæ ¼å¼çº¦å®šã€‚åœ¨éµå®ˆ Python æ ·å¼çº¦å®šæ–¹é¢æœ‰å¾ˆå¤šé€‰æ‹©ï¼Œä½†å¤§å¤šæ•°éƒ½åŸºäº[PEP8](https://www.python.org/dev/peps/pep-0008/)çº¦å®šã€‚ä¸åŒçš„å›¢é˜Ÿéµå¾ªä¸åŒçš„çº¦å®šï¼Œè¿™å®Œå…¨æ²¡é—®é¢˜ã€‚æœ€é‡è¦çš„æ–¹é¢æ˜¯ï¼š

-   `consistency`: æ¯ä¸ªäººéƒ½éµå¾ªç›¸åŒçš„æ ‡å‡†ã€‚
-   `automation`ï¼šåœ¨åˆå§‹é…ç½®åï¼Œæ ¼å¼åŒ–åº”è¯¥å¾ˆå®¹æ˜“ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨éå¸¸æµè¡Œçš„é£æ ¼å’Œæ ¼å¼çº¦å®šçš„æ··åˆï¼Œä»£è¡¨æˆ‘ä»¬åšå‡ºä¸€äº›éå¸¸å›ºæ‰§çš„å†³å®šï¼ˆå¸¦æœ‰å¯é…ç½®çš„é€‰é¡¹ï¼‰ã€‚

-   [`Black`](https://black.readthedocs.io/en/stable/)ï¼šä¸€ä¸ªå°±åœ°é‡æ–°æ ¼å¼åŒ–ç¨‹åºï¼Œï¼ˆå¤§éƒ¨åˆ†ï¼‰[éµå®ˆ](https://black.readthedocs.io/en/stable/the_black_code_style/current_style.html)PEP8ã€‚
-   [`isort`](https://pycqa.github.io/isort/): å¯¹ Python è„šæœ¬ä¸­çš„ import è¯­å¥è¿›è¡Œæ’åºå’Œæ ¼å¼åŒ–ã€‚
-   [`flake8`](https://flake8.pycqa.org/en/latest/index.html): å…·æœ‰ç¬¦åˆ PEP8 çš„é£æ ¼çº¦å®šçš„ä»£ç  linterã€‚

å®‰è£…æ‰€éœ€çš„è½¯ä»¶åŒ…ï¼š

```
pip install black==22.3.0 flake8==3.9.2 isort==5.10.1

```

ç”±äºè¿™äº›æ ·å¼åŒ…ä¸æ˜¯æ ¸å¿ƒæœºå™¨å­¦ä¹ æ“ä½œçš„ç»„æˆéƒ¨åˆ†ï¼Œè®©æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„ ä¸­åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„åˆ—è¡¨`setup.py`ï¼š

<table><tbody><tr><td><div><pre><span></span><span><span><span>1 </span></span></span>
<span><span><span>2 </span></span></span>
<span><span><span>3 </span></span></span>
<span><span><span>4 </span></span></span>
<span><span><span>5 </span></span></span>
<span><span><span>6 </span></span></span>
<span><span><span>7 </span></span></span>
<span><span><span>8 </span></span></span>
<span><span><span>9 </span></span></span>
<span><span><span>10 </span></span></span>
<span><span><span>11 </span></span></span>
<span><span><span>12 </span></span></span>
<span><span><span>13 </span></span></span>
<span><span><span>14 </span></span></span>
<span><span><span>15</span></span></span></pre></div></td><td><div><pre><span></span><code><span># setup.py</span>
<span>style_packages</span> <span>=</span> <span>[</span>
    <span>"black==22.3.0"</span><span>,</span>
    <span>"flake8==3.9.2"</span><span>,</span>
    <span>"isort==5.10.1"</span>
<span>]</span><span></span>
<span></span>
<span># Define our package</span>
<span>setup</span><span>(</span>
    <span>...</span>
    <span>extras_require</span><span>=</span><span>{</span>
<span>        <span>"dev"</span><span>:</span> <span>docs_packages</span> <span>+</span> <span>style_packages</span><span>,</span>
</span>        <span>"docs"</span><span>:</span> <span>docs_packages</span><span>,</span>
    <span>},</span>
<span>)</span>
</code></pre></div></td></tr></tbody></table>

> Unlike `docs`, we don't add `style_packages` as a separate `extras_require` because there is no need for someone to install just the style packages. So we can just add it to the `dev` option.

## Configuration

Before we can properly use these tools, we'll have to configure them because they may have some discrepancies amongst them since they follow slightly different conventions that extend from PEP8.

### Black

To configure Black, we could just pass in options using the [CLI method](https://black.readthedocs.io/en/stable/usage_and_configuration/the_basics.html#command-line-options), but it's much more efficient (especially so others can easily find all our configurations) to do this through a file. So we'll create a `pyproject.toml` in the root of our project directory with the following:

<table><tbody><tr><td><div><pre><span></span><span> 1</span>
<span> 2</span>
<span> 3</span>
<span> 4</span>
<span> 5</span>
<span> 6</span>
<span> 7</span>
<span> 8</span>
<span> 9</span>
<span>10</span>
<span>11</span>
<span>12</span>
<span>13</span>
<span>14</span>
<span>15</span>
<span>16</span>
<span>17</span>
<span>18</span></pre></div></td><td><div><pre><span></span><code><span># Black formatting</span><span></span>
<span>[tool.black]</span><span></span>
<span>line-length</span><span> </span><span>=</span><span> </span><span>100</span><span></span>
<span>include</span><span> </span><span>=</span><span> </span><span>'\.pyi?$'</span><span></span>
<span>exclude</span><span> </span><span>=</span><span> </span><span>'''</span>
<span>/(</span>
<span>      .eggs         # exclude a few common directories in the</span>
<span>    | .git          # root of the project</span>
<span>    | .hg</span>
<span>    | .mypy_cache</span>
<span>    | .tox</span>
<span>    | venv</span>
<span>    | _build</span>
<span>    | buck-out</span>
<span>    | build</span>
<span>    | dist</span>
<span>  )/</span>
<span>'''</span><span></span>
</code></pre></div></td></tr></tbody></table>

Here we're telling Black that our maximum line length should be 100 characters and to include and exclude certain file extensions.

> The [pyproject.toml](https://www.python.org/dev/peps/pep-0518/#file-format) was created to establish a more human-readable configuration file that is meant to replace a `setup.py` or `setup.cfg` file and is increasingly adopted by many open-source libraries.

### isort

Next, we're going to configure isort in our `pyproject.toml` file (just below Black's configurations):

<table><tbody><tr><td></td><td><div><pre><span></span><code><span># iSort</span><span></span>
<span>[tool.isort]</span><span></span>
<span>profile</span><span> </span><span>=</span><span> </span><span>"black"</span><span></span>
<span>line_length</span><span> </span><span>=</span><span> </span><span>79</span><span></span>
<span>multi_line_output</span><span> </span><span>=</span><span> </span><span>3</span><span></span>
<span>include_trailing_comma</span><span> </span><span>=</span><span> </span><span>true</span><span></span>
<span>virtual_env</span><span> </span><span>=</span><span> </span><span>"venv"</span><span></span>
</code></pre></div></td></tr></tbody></table>

Though there is a [complete list](https://pycqa.github.io/isort/docs/configuration/options) of configuration options for isort, we've decided to set these explicitly so there are no conflicts with Black.

### flake8

Lastly, we'll set up flake8, but this time we need to create a separate `.flake8` file to define its configurations:

<table><tbody><tr><td></td><td><div><pre><span></span><code><span>[flake8]</span><span></span>
<span>exclude</span><span> </span><span>=</span><span> </span><span>venv</span><span></span>
<span>ignore</span><span> </span><span>=</span><span> </span><span>E501</span><span>,</span><span> </span><span>W503</span><span>,</span><span> </span><span>E226</span><span></span>
<span>max-line-length</span><span> </span><span>=</span><span> </span><span>79</span><span></span><span></span>
<span></span>
<span># E501: Line too long</span><span></span>
<span># W503: Line break occurred before binary operator</span><span></span>
<span># E226: Missing white space around arithmetic operator</span><span></span>
</code></pre></div></td></tr></tbody></table>

Here we're including an `ignore` option to ignore certain [flake8 rules](https://www.flake8rules.com/) so everything works with our Black and isort configurations.

Besides defining configuration options here, which are applied globally, we can also choose to specifically ignore certain conventions on a line-by-line basis. Here is an example of how we utilize this:

<table><tbody><tr><td></td><td><div><pre><span></span><code><span># tagifai/config.py</span>
<span>import</span> <span>pretty_errors</span>  <span># NOQA: F401 (imported but unused)</span>
</code></pre></div></td></tr></tbody></table>

By placing the `# NOQA: <error-code>` on a line, we're telling flake8 to do **NO** _Q_uality _A_ssurance for that particular error on this line.

## Usage

To use these tools that we've configured, we have to execute them from the project directory:

```
black .
All done! âœ¨ ğŸ° âœ¨
9 files left unchanged.
flake8
python3 -m isort . isort .
Fixing ...

```

Take a look at your files to see all the changes that have been made!

> the `.` signifies that the configuration file for that package is in the current directory

In our [makefile lesson](https://madewithml.com/courses/mlops/makefile/) we'll learn how to combine all these commands into one. And in our [pre-commit lesson](https://pre-commit.com/) we'll learn how to automatically execute this formatting whenever we make changes to our code.

___

è¦å¼•ç”¨æ­¤å†…å®¹ï¼Œè¯·ä½¿ç”¨ï¼š

<table><tbody><tr><td></td><td><div><pre><span></span><code><span>@article</span><span>{</span><span>madewithml</span><span>,</span><span></span>
<span>    </span><span>author</span><span>       </span><span>=</span><span> </span><span>{Goku Mohandas}</span><span>,</span><span></span>
<span>    </span><span>title</span><span>        </span><span>=</span><span> </span><span>{ Styling - Made With ML }</span><span>,</span><span></span>
<span>    </span><span>howpublished</span><span> </span><span>=</span><span> </span><span>{\url{https://madewithml.com/}}</span><span>,</span><span></span>
<span>    </span><span>year</span><span>         </span><span>=</span><span> </span><span>{2022}</span><span></span>
<span>}</span><span></span>
</code></pre></div></td></tr></tbody></table>