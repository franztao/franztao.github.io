---
layout:     post
title:      TSR数据标注
subtitle:   2022年8月
date:       2022-8-31
author:     franztao
header-img: post-bg-re-vs-ng2.jpg
catalog: true
tags:
    - Blog

---

一、整体要求

1、对表格图片进行类别标注，对图片上的表格画横和竖的物理实线，在完成横和竖的实线后表格形成m*n的长方形格子区域，对语义上是相关的物理格子进行合并，标注是表头的格子区域。

2、最终交付的标注成果数据为 JSON 格式文件。

二、 标注对象

| 元素  | 定义          | 备注  |
| --- | ----------- | --- |
| 横线  | 划分表格多少行的线   | x   |
| 竖线  | 划分表格多少列的线   | x   |
| 黄线  | 语义上是相关的物理格子 | x   |
| 红线  | 语义上是表头的区域   | X   |

标注样例：

| 样例名                                      | 图片                                                                                                       |
| ---------------------------------------- | -------------------------------------------------------------------------------------------------------- |
| jm200385u(OT_MT1,MT2_cl_vdss).pdf_6_9    | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-09-15-20-22-07-image.png) |
| jm200386s(OT_PI3K,mTOR_cl_vdss).pdf_10_5 | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-09-15-20-24-14-image.png) |
| jm200712h（pdb_FLT3_Cl）.pdf_6_16          | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-09-15-20-26-00-image.png) |
| jm200900q（pdb_OT_FMS_Cl）.pdf_12_13       | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-09-15-20-27-17-image.png) |

三、标注数据前统计（元数据信息字段（参考下图数据视角和数据采集采样构造））

![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-09-25-17-17-32-7c8c61b362ef7ae33253b14a6ddfc93.jpg)

![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/表格分类.png)

![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-09-25-17-40-28-image.png)

| 表格一级属性 | 表格二级属性                   | 一级分类                          | 二级分类           | 样例                                                                                                                                                                                                                                                                     |
| ------ | ------------------------ | ----------------------------- | -------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| CV     | is_exist_ocsr            | is_exist_markush_group        | R_alpha        |                                                                                                                                                                                                                                                                        |
|        |                          |                               | R_pic          |                                                                                                                                                                                                                                                                        |
|        |                          | is_exist_markush_core         |                |                                                                                                                                                                                                                                                                        |
|        |                          | is_exist_chemical             |                |                                                                                                                                                                                                                                                                        |
|        | is_line_table            |                               |                |                                                                                                                                                                                                                                                                        |
|        | is_table_header_span     | is_table_header_logical_span  |                |                                                                                                                                                                                                                                                                        |
|        |                          | is_table_header_physical_span |                |                                                                                                                                                                                                                                                                        |
|        | rotate                   | 90degree                      |                |                                                                                                                                                                                                                                                                        |
|        | is_tian                  |                               |                |                                                                                                                                                                                                                                                                        |
|        |                          | 是否有线表is_line_table            |                |                                                                                                                                                                                                                                                                        |
|        |                          | 有线表格子数predict_bboxes_num      |                |                                                                                                                                                                                                                                                                        |
|        |                          | is_predict_tsr_ok_delta       |                | 自研的格子数与商用的格子数差                                                                                                                                                                                                                                                         |
|        | OCR                      | 格子平均宽boxes_width              |                |                                                                                                                                                                                                                                                                        |
|        |                          | 格子平均高boxes_height             |                |                                                                                                                                                                                                                                                                        |
|        |                          | 模糊度0-3 0最好                    |                |                                                                                                                                                                                                                                                                        |
|        |                          | 上下标                           | 上标superscripts |                                                                                                                                                                                                                                                                        |
|        |                          |                               | 下标subscripts   |                                                                                                                                                                                                                                                                        |
|        |                          | 中文is_chinese_text             |                |                                                                                                                                                                                                                                                                        |
|        |                          | 数字isnumerics                  | 整数isdigits     |                                                                                                                                                                                                                                                                        |
|        |                          |                               | 浮点数isdecimals  |                                                                                                                                                                                                                                                                        |
|        |                          | 文本isasciis                    | 小写islowers     |                                                                                                                                                                                                                                                                        |
|        |                          |                               | 字母isalpha      |                                                                                                                                                                                                                                                                        |
|        |                          |                               |                |                                                                                                                                                                                                                                                                        |
|        |                          | 换行                            |                |                                                                                                                                                                                                                                                                        |
|        |                          | 运算符号operaters                 |                | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-11-10-17-14-45-image.png)<br/>![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-11-10-17-19-55-image.png)                                                                                          |
|        |                          | 正负号pms                        |                |                                                                                                                                                                                                                                                                        |
|        |                          | 是否存在下划线                       |                | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-11-10-17-15-58-image.png)                                                                                                                                                                                   |
|        |                          | 是否虚线格子                        |                |                                                                                                                                                                                                                                                                        |
|        |                          | is_special_alpha特殊符号          |                | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-11-10-17-25-03-image.png)                                                                                                                                                                                   |
| NLP    | is_has_compound          |                               |                | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-10-27-15-26-10-image.png)<br/>![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-10-27-15-27-18-image.png)                                                                                          |
|        | is_parellel_text         |                               |                | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-10-27-15-26-27-image.png)<br/>![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-10-27-15-26-45-image.png)<br/>![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-10-27-15-27-05-image.png) |
|        | is_compound_first_coloum |                               |                |                                                                                                                                                                                                                                                                        |
|        | languague                |                               |                |                                                                                                                                                                                                                                                                        |
|        |                          |                               |                |                                                                                                                                                                                                                                                                        |
| 预测属性   | is_predict_dod_ok        |                               |                |                                                                                                                                                                                                                                                                        |
|        | is_predict_green_box_ok  |                               |                |                                                                                                                                                                                                                                                                        |
|        | is_predict_line_ok       |                               |                |                                                                                                                                                                                                                                                                        |
|        | is_predict_span_ok       |                               |                |                                                                                                                                                                                                                                                                        |
|        | is_predict_ocsr_ok       | mask_not_small_tail           |                |                                                                                                                                                                                                                                                                        |
|        |                          | mask_not_spe_pic              |                |                                                                                                                                                                                                                                                                        |
|        |                          | mask_not_index                |                |                                                                                                                                                                                                                                                                        |
|        |                          | mask_real_line                |                |                                                                                                                                                                                                                                                                        |
|        |                          | mask_not_alpha                |                |                                                                                                                                                                                                                                                                        |
|        | is_predict_tsr_ok        |                               |                |                                                                                                                                                                                                                                                                        |
|        | is_predict_ocr_ok        |                               |                |                                                                                                                                                                                                                                                                        |

四、标注原则：

1）画线规则：

> 1.在预标注不满足的情况下，需要重新画横或者竖线的，第一依据是在需要画线的范围内，范围内本来有一条图片的实线存在，则沿着实线画横或者竖线。
> 
> 2.无实线的，则在空白中间上画，即绿色格子的相互中间区域

2）直线穿过原则：画线不能穿过分子式，完整字符之间等有颜色的像素字符

3）边界原则：边界线跟实际表格区域不多于5 pt(肉眼可见能分开线与表格内的字符元素)

4）标注顺序规则：

> 1.确定横线（红线）是否画好
> 2.确定竖线（蓝线）是否画好
> 3.确定合并区域（黄线,逻辑格子）是否画好
> 4.画缺失的横、竖线
> 5.删除冗余的横、竖线
> 6.成完整田字表格后，合并应该合并成一起的物理格子
> 7.删除冗余的合并区域（黄线）

三、常见标注错误（持续补充）：

| 错误类型 | 违反规则 | 错误分析                | 样例                                              | x                                                                                                        |
| ---- | ---- | ------------------- | ----------------------------------------------- | -------------------------------------------------------------------------------------------------------- |
| 线段不对 | x    | 第一行物理像素上分开，逻辑上不应该分开 | jm200712h（pdb_FLT3_Cl）.pdf_5_3                  | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-09-15-20-29-13-image.png) |
| 格子不对 | x    | 少合并格子               |                                                 |                                                                                                          |
| x    | x    | 合并格子多合并冗余物理格子       | jm2014887(OT_Glucokinase_cl_papp_vdss).pdf_6_15 | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-09-15-20-10-46-image.png) |
| x    | x    | 合并格子多合并冗余物理格子       | jm2014887(OT_Glucokinase_cl_papp_vdss).pdf_6_10 | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-09-15-20-13-54-image.png) |
| x    | x    | x                   | jm2012968(OT_GPR40,FFA1_cl).pdf_8_4             | ![](https://raw.githubusercontent.com/franztao/blog_picture/main/marktext/2022-09-15-20-17-21-image.png) |

五、标注检查规范：

线错的情况分类

线不准的情况分类

1. 缺线数量

2. 多线数量

格子不准的情况分类

   1. 多逻辑格子数量

    2. 少逻辑格子数量

六、标注质量指标（交付数据的质控标准）

1. 线错数

2. 线缺数

3. 线多数

4. 格缺数

5. 格多数

七、数据标注流程

1. 数据采集，算法提供预标注的表格图片，表格图片来自表格检测的标注数据

2. 数据预处理，表格图片会经过掩盖ocsr分子处理

3. 数据管理，元数据信息字段（同DOD数据标注任务）

   4.模型预标注，在通过模型预标注之后，需要检查预标注结果以此来挖掘试标注的不足之处，随后根据不足之处进行补充标注。

   5.交付标注数据，导入成COCO数据格式，统计标注质量，标注结果汇总统计

```
{
  "images": [
    {
      "id": 1,
      "width": 800,
      "height": 600,
      "file_name": "test.jpg",
      "..":"补充自有图片属性"
    }
  ],
  "annotations": [
    {
      "id": 1,
      "image_id": 1,
      "category_id": 1,
      "bbox": [0,0,10,10],
      "segmentation": [
          [0,0,10,0,10,10,0,10]
      ],
      "area": 100,
      "iscrowd": 0,
      "NLP",{依据脑图树形层次写入自有标签，并且跟coco格式兼容}
      "CV",{依据脑图树形层次写入自有标签，并且跟coco格式兼容}
    }
  ]
}
```

八、标注数据范围和计划

| 元素     | 是否算法预标注 | 是否需要标注和基于预标注修正 |
| ------ | ------- | -------------- |
| 横线     | 是       | 是              |
| 竖线     | 否       | 是              |
| 黄线     | 否       | 是              |
| 语义表达形式 | 否       | 是              |

| 事件    | 数据规模  | 工期  | 人员配比 | 交付要求    |
| ----- | ----- | --- | ---- | ------- |
| 预标注   | 100   | x   | x    | 准确率≥99% |
| 第一批标注 | 30W图片 | x   | x    | 准确率≥99% |
|       |       |     |      |         |
